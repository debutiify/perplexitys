"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2646],{3041:(e,t,r)=>{r.d(t,{n_:()=>u,vF:()=>c,zm:()=>d});var n=r(25203),a=r(1552),o=r(83480),i=r(81080),s=r(88300);function l(e,t){let{message:r,error:o,extra:s}=t,l=[r,s,o];(0,i.YW)(e).with("error",()=>{n.yf.logger.error(...l);try{a.L.addError(o,{message:r,extra:s})}catch(e){}}).with("warn",()=>n.yf.logger.warn(...l)).with("log",()=>n.yf.logger.info(...l)).with("debug",()=>n.yf.logger.debug(...l)).with("info",()=>n.yf.logger.info(...l)).exhaustive()}let c={log:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];l("debug",(0,s.e)(...t))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];l("error",(0,s.e)(...t))},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];l("warn",(0,s.e)(...t))},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];l("debug",(0,s.e)(...t))},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];l("info",(0,s.e)(...t))}};function u(e){let{ddClientToken:t,version:r,env:a,debug:i,sessionSampleRate:s,service:l="web-nextjs"}=e,c=(0,o.h)(navigator.userAgent);n.yf.init({clientToken:t,site:"datadoghq.com",service:l,env:a,version:r,sessionSampleRate:s,forwardErrorsToLogs:!0,forwardConsoleLogs:["warn","error","info"],silentMultipleInit:i,beforeSend:e=>{var t,r,n,a,o;return!(!c||(null===(t=e.http)||void 0===t?void 0:t.url.includes("reddit.com")))&&((null===(r=e.http)||void 0===r?void 0:r.status_code)===0&&(e.status="warn"),(!((null===(n=e.error)||void 0===n?void 0:n.handling)==="unhandled"&&(null===(a=e.message)||void 0===a?void 0:a.includes("Script error.")))||!!(null===(o=e.error)||void 0===o?void 0:o.cause))&&("error"===e.status||"warn"===e.status||"info"===e.status))}}),i&&(n.yf._setDebug(!0),n.yf.onReady(()=>{n.yf.logger.setHandler("http")}))}function d(e){Object.entries(e).forEach(e=>{let[t,r]=e;n.yf.setGlobalContextProperty(t,r)})}},3889:(e,t,r)=>{r.d(t,{W:()=>o});var n=r(84447),a=r(16690);class o extends a.X{constructor(...e){super(...e),(0,n._)(this,"name","FetcherError")}}},12971:(e,t,r)=>{r.d(t,{a9:()=>C,Sv:()=>w,G1:()=>S});var n=r(3041),a=r(55179),o=r(39767),i=r(66516),s=r(3889);let l=e=>{let t=new URL(e),r=t.searchParams;return r.get("version")||r.set("version",a.mj),r.get("source")||r.set("source",a.tl),t},c=e=>{switch(e){case 400:case 403:case 404:default:return!1;case 401:case 409:case 500:case 502:case 429:return!0}},u=e=>{if(!e)return 0;let t=parseInt(e,10);if(!isNaN(t))return Math.max(0,1e3*t);let r=new Date(e).getTime();return isNaN(r)?0:Math.max(0,r-Date.now())},d=(e,t,r)=>r+e*Math.pow(2,t),f=async e=>{let t,{resource:r,options:o={},timeoutMs:i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1200;try{let t=globalThis.navigator.userAgent.includes("Mobile")&&!globalThis.navigator.userAgent.includes("iPad"),r="unknown",n=10;if(globalThis.navigator.connection&&(r=globalThis.navigator.connection.type,n=globalThis.navigator.connection.downlink),t||n<1||"cellular"===r)return 2*e;return e}catch(t){return e}}(),method:l="GET",body:f,numRetries:m=0,backOffTime:h=1e3,reason:g}=e,v={...o,method:l,body:f},E=new Headers(v.headers);E.set(a.Hq,g);let _=()=>null;if(i&&(_=()=>{let e=new DOMException("fetch ".concat(r," timed out (").concat(i,"ms)"),"TimeoutError"),t=new AbortController;return v.signal=t.signal,setTimeout(()=>t.abort(e),i)}),m>2){let e=new s.W("FETCHER_MAX_RETRIES_EXCEEDED",{details:{resource:r,numRetries:m,maxRetries:2}});n.vF.error(e)}let p=null,w=h,R=0,T=0;do{m>0&&T>0&&await new Promise(e=>setTimeout(e,w));let e=_();R=0,t=void 0;try{if(E.set("X-Perplexity-Request-Try-Number",String(T+1)),E.set("X-Perplexity-Request-Endpoint",String(r)),p=await fetch(r,{...v,headers:E}),clearTimeout(e),!p.ok&&c(p.status))R=u(p.headers.get("Retry-After"));else break}catch(e){t=e}clearTimeout(e),w=d(h,T,R),++T}while(T<=m);if(!t&&!p.ok){var y;if(403===p.status&&(null===(y=p.headers.get("cf-mitigated"))||void 0===y?void 0:y.includes("challenge")))t=new s.W("FETCHER_CLOUDFLARE_403_ERROR",{message:"Cloudflare 403 error"});else{let e=p.clone(),r=(await e.text()).trimStart();(r.startsWith("<!DOCTYPE html")||r.startsWith("<html"))&&(t=new s.W("FETCHER_HTML_STATUS_ERROR",{message:"".concat(p.status," error"),details:{html:r,status:p.status}}))}}if(t)throw n.vF.log("".concat(v.method," ").concat(r," exception"),t),t._fetchMethod=v.method,t._fetchResource=r,t;return p};async function m(e){var t,r;let{url:a,params:l,handlers:c,legacyEvents:u={},headers:d={},signal:f,metrics:m={},timer:h}=e,g=null!==(t=u.message)&&void 0!==t?t:"message",v=null!==(r=u.endOfStream)&&void 0!==r?r:"end_of_stream",E=u.message&&u.endOfStream,{now:_,...p}=m;h?h.setGlobalContext({path:a.pathname,...p}):h=(0,i.Ip)({path:a.pathname,...p},{nowFromTimeOrigin:performance.now()});let{addTiming:w,addTimingOnce:R}=h;return w("web.sse.start"),new Promise((e,t)=>{let r,n;let u=new o.G(a,{withCredentials:!0,fetch:(e,t)=>{var r;return fetch(e,{...t,method:"POST",body:l?JSON.stringify(l):void 0,credentials:"include",signal:f,headers:{"content-type":"application/json",...null!==(r=null==t?void 0:t.headers)&&void 0!==r?r:{},...d}})}});function m(){n=n?void 0:(0,i.Ip)({path:a.pathname,...p})}function h(){clearTimeout(r),r=setTimeout(()=>{try{u.close()}catch(e){}finally{A()}t(new s.W("FETCHER_SSE_CHUNK_TIMEOUT",{details:{submitParams:l}}))},6e5)}function _(e){clearTimeout(r);try{u.close()}catch(e){}finally{A()}e instanceof s.W?t(e):t(new s.W("FETCHER_SSE_ERROR",{cause:e,message:"An error occurred while streaming",details:{submitParams:l}}))}let T=e=>{let t="FETCHER_SSE_ERROR";navigator.onLine&&"network error"!==e.message?e.code?403===e.code&&(t="FETCHER_CLOUDFLARE_403_ERROR"):t="FETCHER_SSE_NO_STATUS_CODE_ERROR":t="FETCHER_SSE_OFFLINE_ERROR",_(new s.W(t,{cause:e,details:{code:t,message:e.message,type:e.type,submitParams:l}}))},y=()=>{var e;h(),w("web.sse.connection_opened"),null===(e=c.open)||void 0===e||e.call(c)},C=e=>{let t;try{R("web.sse.first_message_seen"),m(),h(),t=JSON.parse(e.data)}catch(e){return _(new s.W("FETCHER_SSE_CHUNK_PROCESSING_ERROR",{cause:e,details:{submitParams:l}}))}c.message(t)},S=t=>{let n;try{R("web.sse.first_message_seen"),m(),clearTimeout(r);try{u.close()}catch(e){}finally{A()}n=JSON.parse(t.data)}catch(e){return _(new s.W("FETCHER_SSE_EOS_ERROR",{cause:e,details:{submitParams:l}}))}E&&c.message(n),w("web.sse.end_of_stream"),e()},b=e=>{var t;let r;try{r=JSON.parse(e.data)}catch(e){return _(new s.W("FETCHER_SSE_INFO_CHUNK_PARSE_ERROR",{cause:e,details:{submitParams:l}}))}null===(t=c.info)||void 0===t||t.call(c,r)};u.addEventListener("error",T),u.addEventListener("open",y),u.addEventListener(g,C),u.addEventListener(v,S),u.addEventListener("info",b);let A=()=>{u.removeEventListener("error",T),u.removeEventListener("open",y),u.removeEventListener(g,C),u.removeEventListener(v,S),u.removeEventListener("info",b)};h()}).catch(e=>{var t,r;if(e instanceof Error&&(null!==(r=null===(t=e.cause)||void 0===t?void 0:t.code)&&void 0!==r?r:0)>0)throw e;throw n.vF.error("SSE error",e,{path:a.pathname}),e})}var h=r(24915);"set_to_undefined"===h.env.NEXT_PUBLIC_DEFAULT_SOCKET_URL||h.env.NEXT_PUBLIC_DEFAULT_SOCKET_URL;let g=()=>{let e={};return h.env.NEXT_PUBLIC_CF_ACCESS_ID&&(e["CF-Access-Client-Id"]=h.env.NEXT_PUBLIC_CF_ACCESS_ID),h.env.NEXT_PUBLIC_CF_ACCESS_SECRET&&(e["CF-Access-Client-Secret"]=h.env.NEXT_PUBLIC_CF_ACCESS_SECRET),h.env.NEXT_PUBLIC_PPL_DEV_HEADER_NAME&&h.env.NEXT_PUBLIC_PPL_DEV_HEADER_TOKEN&&(e[h.env.NEXT_PUBLIC_PPL_DEV_HEADER_NAME]=h.env.NEXT_PUBLIC_PPL_DEV_HEADER_TOKEN),e},v=(e,t)=>{let r=e.replace(/\/+$/,"");return new URL(t.replace(/^\/+/,""),r).toString()};var E=r(23651),_=r(24915);let p=e=>{let t=new URL(e);return globalThis.location.hostname.includes("localhost")||(t.protocol=globalThis.location.protocol,t.hostname=globalThis.location.hostname),t.toString()};function w(){return _.env.NEXT_PUBLIC_REST_ASYNC_SERVER_URL||p("https://testing.i.perplexity.ai")}let R={jwt:null,ttl:0,promise:void 0},T=async()=>{if(R.ttl>Date.now())return R.jwt;try{var e;R.promise=null!==(e=R.promise)&&void 0!==e?e:fetch("/api/auth/token",{headers:{"X-Token-Type":"Perplexity-JWT"}}).then(e=>e.json()).then(e=>e.perplexity_jwt),R.jwt=await R.promise,R.ttl=Date.now()+54e4}catch(e){R.jwt=null,R.ttl=0,n.vF.warn("Error getting dev token:",e)}finally{R.promise=void 0}return R.jwt},y=e=>{let{clientHeaders:t,isMobile:r,isWindowsApp:n}=e,o=(0,E.e)(r,n),i=t instanceof Headers?new Headers(t):new Headers(Object.entries(null!=t?t:{}).filter(e=>void 0!==e[1]).map(e=>{let[t,r]=e;return[t,Array.isArray(r)?r.join(", "):r]})),s=new Headers({...g(),"X-App-ApiClient":o,"X-App-ApiVersion":a.mj});return i.forEach((e,t)=>{s.set(t,e)}),s};async function C(e){var t;let{urlPath:r,timeoutMs:n,method:a,body:o,headers:i,baseUrlOverride:s,redirect:c,numRetries:u,backOffTime:d,reason:m,includeCredentials:h}=e,g=y({clientHeaders:i,isMobile:navigator.userAgent.includes("Mobile"),isWindowsApp:navigator.userAgent.includes("WindowsApp")}),E={headers:g,redirect:c,credentials:"same-origin"},_=null!==(t=globalThis.location.hostname.includes("localhost"))&&void 0!==t&&t;if(_&&E.headers){let e=await T();g.set("authorization","Bearer ".concat(e))}return(_||h)&&(E.credentials="include"),f({resource:l(v(null!=s?s:w(),r)),options:E,timeoutMs:n,method:a,body:o,numRetries:u,backOffTime:d,reason:m})}async function S(e){var t;let{url:r,headers:n,...a}=e,o=new URL(r,w()),i=null!==(t=globalThis.location.hostname.includes("localhost"))&&void 0!==t&&t,s={},l="";if(i){let e=await T();l="Bearer ".concat(e),s.authorization=l}return m({url:o,headers:{...n,...s},...a})}},23651:(e,t,r)=>{r.d(t,{e:()=>a});var n=r(55179);let a=(e,t)=>e?n.en:t?n.Tq:n.tl},27143:(e,t,r)=>{r.d(t,{n:()=>o});var n=r(1552),a=r(83480);function o(e){if(!e)return;let t=(0,a.h)(navigator.userAgent),{ddApplicationId:r,ddClientToken:o,version:i,env:s,debug:l}=e;r&&o&&(n.L.init({applicationId:r,clientToken:o,site:"datadoghq.com",service:"web-nextjs",env:s,version:i,sessionSampleRate:e.sessionSampleRate,sessionReplaySampleRate:e.sessionReplaySampleRate,defaultPrivacyLevel:"mask-user-input",allowedTracingUrls:[/\.perplexity\.ai/,"http://localhost:3000"],compressIntakeRequests:!0,silentMultipleInit:l,beforeSend:(r,n)=>!!t&&(!e.beforeSend||e.beforeSend(r,n))}),l&&n.L._setDebug(!0))}},47603:(e,t,r)=>{r.d(t,{vF:()=>f});var n=r(72484),a=r(81080),o=r(88300);let{error:i,warn:s,debug:l,info:c,log:u}=console;function d(e,t){let{message:r,extra:o,error:d}=t,f=JSON.stringify({message:r,extra:o,error:(0,n.P5)(d),timestamp:new Date().toISOString()});(0,a.YW)(e).with("error",()=>i(f)).with("warn",()=>s(f)).with("log",()=>u(f)).with("debug",()=>l(f)).with("info",()=>c(f)).exhaustive()}let f={log:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];d("debug",(0,o.e)(...t))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];d("error",(0,o.e)(...t))},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];d("warn",(0,o.e)(...t))},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];d("debug",(0,o.e)(...t))},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];d("info",(0,o.e)(...t))}}},52155:(e,t,r)=>{r.d(t,{t:()=>o});var n=r(85860),a=r(1552);let o=n.memo(e=>{let{session:t,isWindowsApp:r}=e;return(0,n.useEffect)(()=>{if(t){var e;a.L.setUser({id:t.id,name:null!==(e=t.name)&&void 0!==e?e:"",email:t.email}),a.L.setGlobalContextProperty("isPro",t.isPro),a.L.setGlobalContextProperty("isWindowsApp",r)}},[t,r]),null});o.displayName="MetricsAgent"},55179:(e,t,r)=>{r.d(t,{Hq:()=>l,Qc:()=>o,Tq:()=>s,en:()=>i,kC:()=>c,mj:()=>n,tl:()=>a});let n="2.18",a="default",o="server",i="mweb",s="windowsapp",l="X-Perplexity-Request-Reason",c="X-Request-ID"},63300:(e,t,r)=>{r.d(t,{E:()=>o});var n=r(85860),a=r(25203);let o=n.memo(e=>{let{session:t,isWindowsApp:r}=e;return(0,n.useEffect)(()=>{if(t){var e;a.yf.setUser({id:t.id,name:null!==(e=t.name)&&void 0!==e?e:"",email:t.email}),a.yf.setGlobalContextProperty("isPro",t.isPro),a.yf.setGlobalContextProperty("isWindowsApp",r)}},[t,r]),null});o.displayName="LoggerAgent"},66516:(e,t,r)=>{r.d(t,{Lr:()=>u,Rh:()=>s,zm:()=>c,Ip:()=>l});var n=r(1552),a=r(3041);let o="web.custom_metrics";function i(e,t,r){a.vF.info(o,{metricName:e,duration:t,...r})}function s(e,t){let{verbose:r,raiseOnError:i,onlyUseRum:s=!0,...l}=t,{duration:c,startTime:u,...d}=l;n.L.addDurationVital(e,{startTime:u,duration:c,context:d}),s||a.vF.info(o,{metricName:e,...l})}function l(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(null!==(e=r.nowFromTimeOrigin)&&void 0!==e?e:performance.now())+performance.timeOrigin;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{transport:t=i,nowFromTimeOrigin:r=performance.now()}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={...e},a=new Set,o=[];function s(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=performance.now()-r,s={metricName:e,duration:i};return o.push(s),t(e,i,{...n,...a,startTime:r+performance.timeOrigin}),s}return{addTimingOnce:function(e,t){return a.has(e)?o.find(t=>t.metricName===e):(a.add(e),s(e,t))},addTiming:s,getEvents:()=>o,setGlobalContext(e){Object.assign(n,e)},getStartTimeFromTimeOrigin:()=>r,getAbsoluteStartTime:()=>r+performance.timeOrigin}}(t,{...r,transport:(e,t,r)=>{n.L.addDurationVital(e,{startTime:a,duration:t,context:r})}})}function c(e){Object.entries(e).forEach(e=>{let[t,r]=e;n.L.setGlobalContextProperty(t,r)})}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.L.addAction(e,t)}},88300:(e,t,r)=>{r.d(t,{e:()=>a});var n=r(16690);function a(){let e;for(var t=arguments.length,r=Array(t),a=0;a<t;a++)r[a]=arguments[a];let o={},i=[];r.filter(Boolean).forEach(t=>{t instanceof n.X?(e=t,i.push(t.message),t.details&&Object.assign(o,{pplx_error_code:t.code,...t.details})):t instanceof Error?(e=t,i.push(t.message)):"object"==typeof t?Object.assign(o,t):i.push(t)});let s=i.join(" ");return e?{message:s,error:e,extra:o}:{message:s,extra:o}}}}]);
//# sourceMappingURL=platform-69187d8620c4510b.js.map